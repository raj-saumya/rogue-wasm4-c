#include "types.h"
#include "wasm4.h"

#include <stdint.h>

const uint8_t DEMON_SPRITE[864] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x14, 0x00, 0x00, 0x00, 0x00, 0x03, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x14, 0x00, 0x00, 0x00, 0x00, 0x03, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x14, 0x00, 0x00, 0x00, 0x00, 0x03, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x14, 0x00, 0x00, 0x00, 0x00, 0x05, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x14, 0x00, 0x00, 0x00, 0x00, 0x05, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x14, 0x00, 0x00, 0x00, 0x00, 0x05, 0x14,
    0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5,
    0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5,
    0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xc5,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3c,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x5f, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x5f,
    0x00, 0x00, 0x00, 0x00, 0x0f, 0xdf, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xdf,
    0x00, 0x00, 0x00, 0x00, 0x0d, 0x5f, 0x00, 0x00, 0x00, 0x00, 0x05, 0x5f,
    0x00, 0x00, 0x00, 0x00, 0x06, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x4c,
    0x00, 0x00, 0x00, 0x00, 0x0e, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x0e, 0xcc,
    0x00, 0x00, 0x00, 0x00, 0x0e, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x06, 0x4c,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x50, 0x00, 0x00, 0x00, 0x00, 0x01, 0x50,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x50, 0x00, 0x00, 0x00, 0x00, 0x01, 0x50,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x50, 0x00, 0x00, 0x00, 0x00, 0x01, 0x50,
    0x00, 0x00, 0x14, 0x00, 0x01, 0x80, 0x00, 0x00, 0x14, 0x00, 0x01, 0x80,
    0x00, 0x00, 0x14, 0x00, 0x01, 0x80, 0x00, 0x00, 0x14, 0x00, 0x01, 0x80,
    0x00, 0x00, 0x14, 0x00, 0x01, 0x80, 0x00, 0x00, 0x14, 0x00, 0x01, 0x80,
    0x00, 0x00, 0x1c, 0x00, 0x84, 0x20, 0x00, 0x00, 0x1c, 0x00, 0x84, 0x20,
    0x00, 0x00, 0x1c, 0x00, 0x84, 0x20, 0x00, 0x00, 0x1c, 0x00, 0x84, 0x20,
    0x00, 0x00, 0x1c, 0x00, 0x84, 0x20, 0x00, 0x00, 0x1c, 0x00, 0x84, 0x20,
    0x00, 0x00, 0x5c, 0x00, 0x14, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x14, 0x00,
    0x00, 0x00, 0x5c, 0x00, 0x14, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x14, 0x00,
    0x00, 0x00, 0x5c, 0x00, 0x14, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x14, 0x00,
    0x00, 0x00, 0xa9, 0x00, 0x14, 0x00, 0x00, 0x00, 0xa9, 0x00, 0x14, 0x00,
    0x00, 0x00, 0xa9, 0x00, 0x14, 0x00, 0x00, 0x00, 0xa9, 0x00, 0x14, 0x00,
    0x00, 0x00, 0xa9, 0x00, 0x14, 0x00, 0x00, 0x00, 0xa9, 0x00, 0x14, 0x00,
    0x00, 0x02, 0xa5, 0x00, 0x10, 0x00, 0x00, 0x02, 0xa5, 0x00, 0x10, 0x00,
    0x00, 0x02, 0xa5, 0x00, 0x10, 0x00, 0x00, 0x02, 0xa5, 0x00, 0x10, 0x00,
    0x00, 0x02, 0xa5, 0x00, 0x10, 0x00, 0x00, 0x02, 0xa5, 0x00, 0x10, 0x00,
    0x00, 0x02, 0xa5, 0x00, 0x12, 0x00, 0x00, 0x02, 0xa5, 0x40, 0x12, 0x00,
    0x00, 0x02, 0xa5, 0x40, 0x12, 0x00, 0x00, 0x02, 0xa5, 0x40, 0x12, 0x00,
    0x00, 0x02, 0xa5, 0x40, 0x12, 0x00, 0x00, 0x02, 0xa5, 0x40, 0x12, 0x00,
    0x00, 0x0a, 0x95, 0x40, 0x18, 0x00, 0x00, 0x0a, 0x95, 0x40, 0x18, 0x00,
    0x00, 0x0a, 0x95, 0x40, 0x18, 0x00, 0x00, 0x0a, 0x95, 0x40, 0x18, 0x00,
    0x00, 0x0a, 0x95, 0x40, 0x18, 0x00, 0x00, 0x0a, 0x95, 0x40, 0x18, 0x00,
    0x00, 0x0a, 0x95, 0x42, 0x10, 0x00, 0x00, 0x0a, 0x95, 0x42, 0x10, 0x00,
    0x00, 0x0a, 0x95, 0x42, 0x10, 0x00, 0x00, 0x0a, 0x95, 0x42, 0x10, 0x00,
    0x00, 0x0a, 0x95, 0x42, 0x10, 0x00, 0x00, 0x0a, 0x95, 0x42, 0x10, 0x00,
    0x00, 0x0a, 0x9d, 0x50, 0x10, 0x00, 0x00, 0x0a, 0x9d, 0x50, 0x90, 0x00,
    0x00, 0x0a, 0x9d, 0x50, 0x90, 0x00, 0x00, 0x0a, 0x9d, 0x50, 0x90, 0x00,
    0x00, 0x0a, 0x9d, 0x50, 0x90, 0x00, 0x00, 0x0a, 0x9d, 0x50, 0x50, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x50, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x51, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0xaa, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00, 0x00, 0x2a, 0xbd, 0x50, 0x40, 0x00,
    0x00, 0xaa, 0x7f, 0x54, 0x40, 0x00, 0x00, 0xaa, 0xbf, 0x50, 0x40, 0x00,
    0x02, 0xaa, 0xff, 0x54, 0x40, 0x00, 0x00, 0xaa, 0xbf, 0x54, 0x40, 0x00,
    0x00, 0xaa, 0xbf, 0x54, 0x40, 0x00, 0x00, 0xaa, 0x7f, 0x54, 0x40, 0x00,
    0x00, 0xaa, 0x7f, 0xd4, 0x40, 0x00, 0x02, 0xaa, 0xbf, 0xd0, 0x40, 0x00,
    0x0a, 0xab, 0xff, 0xd4, 0x00, 0x00, 0x02, 0xaa, 0xbf, 0xd4, 0x00, 0x00,
    0x02, 0xaa, 0xbf, 0xf4, 0x40, 0x00, 0x00, 0xaa, 0x7f, 0xd4, 0x40, 0x00,
    0x02, 0xaa, 0x7f, 0xd4, 0x40, 0x00, 0x0a, 0xaa, 0xbf, 0xd0, 0x00, 0x00,
    0x2a, 0xaf, 0xff, 0xd4, 0x00, 0x00, 0x2a, 0xaa, 0xbf, 0xd4, 0x00, 0x00,
    0x0a, 0xaa, 0xbf, 0xf4, 0x00, 0x00, 0x02, 0xaa, 0x7f, 0xd4, 0x40, 0x00};

void Player_init(GameContext *gc) {
  gc->player.pos_x = SCREEN_SIZE / 2 - DEMON_SPRITE_FRAME_SIZE / 2;
  gc->player.pos_y = SCREEN_SIZE / 2 - DEMON_SPRITE_H / 2;
  gc->player.dir = BLIT_2BPP;
  gc->player.health = 100;
}

void Player_render(GameContext *gc) {
  *DRAW_COLORS = 0x2340;

  uint32_t anim_frame =
      (gc->frame_count / DEMON_SPRITE_ANIM_SPEED) % DEMON_SPRITE_FRAME_COUNT;
  uint32_t src_x = anim_frame * DEMON_SPRITE_FRAME_SIZE;

  blitSub(DEMON_SPRITE, gc->player.pos_x, gc->player.pos_y,
          DEMON_SPRITE_FRAME_SIZE, DEMON_SPRITE_H, src_x, 0, DEMON_SPRITE_W,
          gc->player.dir);
}

void Player_move(GameContext *gc, int dx, int dy) {
  gc->player.pos_x += dx;
  gc->player.pos_y += dy;

  Player_render(gc);
}
